<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Toy JavaScript LLM Trainer</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 700px;
      margin: 20px auto;
      padding: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    h1 { font-size: 1.4rem; }
    textarea, input {
      width: 100%;
      box-sizing: border-box;
      margin: 4px 0 10px;
      padding: 6px;
    }
    button {
      padding: 6px 12px;
      margin-right: 6px;
      cursor: pointer;
    }
    .section {
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .log {
      font-size: 0.9rem;
      background: #f7f7f7;
      padding: 8px;
      border-radius: 4px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>“Train” a Tiny JavaScript Chat Model</h1>
  <p>
    This is a toy demo: you add example prompt → response pairs.
    The model stores them in your browser and tries to answer new questions
    using the closest matching prompt.
  </p>

  <div class="section">
    <h2>1. Add training examples</h2>
    <label>Training prompt:</label>
    <textarea id="trainPrompt" rows="2" placeholder="e.g. What is your name?"></textarea>

    <label>Training response:</label>
    <textarea id="trainResponse" rows="2" placeholder="e.g. I am a tiny JS model."></textarea>

    <button id="addExampleBtn">Add example</button>
    <button id="clearExamplesBtn">Clear all training data</button>
    <div id="trainStatus"></div>
  </div>

  <div class="section">
    <h2>2. Chat with your trained model</h2>
    <label>Your message:</label>
    <textarea id="userMessage" rows="2" placeholder="Ask something you've trained it on..."></textarea>
    <button id="askBtn">Ask</button>
    <div id="answer"></div>
  </div>

  <div class="section">
    <h2>Training data (stored locally)</h2>
    <div class="log" id="examplesLog"></div>
  </div>

  <script>
    const STORAGE_KEY = "toy_js_llm_examples_v1";

    function loadExamples() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error("Failed to load examples", e);
        return [];
      }
    }

    function saveExamples(examples) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(examples));
    }

    function renderExamples() {
      const examples = loadExamples();
      const log = document.getElementById("examplesLog");
      if (!examples.length) {
        log.textContent = "No training examples yet.";
        return;
      }
      log.textContent = examples
        .map((ex, i) => `${i + 1}. PROMPT: ${ex.prompt}\n   RESPONSE: ${ex.response}`)
        .join("\n\n");
    }

    function addExample(prompt, response) {
      const examples = loadExamples();
      examples.push({ prompt, response });
      saveExamples(examples);
      renderExamples();
    }

    function clearExamples() {
      localStorage.removeItem(STORAGE_KEY);
      renderExamples();
    }

    // Very simple similarity: count overlapping words
    function similarity(a, b) {
      const wa = a.toLowerCase().split(/\s+/).filter(Boolean);
      const wb = b.toLowerCase().split(/\s+/).filter(Boolean);
      const setB = new Set(wb);
      let score = 0;
      for (const w of wa) {
        if (setB.has(w)) score++;
      }
      return score;
    }

    function findBestMatch(message) {
      const examples = loadExamples();
      if (!examples.length) return null;
      let best = null;
      let bestScore = -1;
      for (const ex of examples) {
        const s = similarity(message, ex.prompt);
        if (s > bestScore) {
          bestScore = s;
          best = ex;
        }
      }
      return bestScore > 0 ? best : null;
    }

    document.getElementById("addExampleBtn").addEventListener("click", () => {
      const prompt = document.getElementById("trainPrompt").value.trim();
      const response = document.getElementById("trainResponse").value.trim();
      const status = document.getElementById("trainStatus");

      if (!prompt || !response) {
        status.textContent = "Please fill in both prompt and response.";
        return;
      }

      addExample(prompt, response);
      document.getElementById("trainPrompt").value = "";
      document.getElementById("trainResponse").value = "";
      status.textContent = "Example added!";
      setTimeout(() => (status.textContent = ""), 1500);
    });

    document.getElementById("clearExamplesBtn").addEventListener("click", () => {
      clearExamples();
      document.getElementById("trainStatus").textContent = "All training data cleared.";
    });

    document.getElementById("askBtn").addEventListener("click", () => {
      const msg = document.getElementById("userMessage").value.trim();
      const answerDiv = document.getElementById("answer");
      if (!msg) {
        answerDiv.textContent = "Type a message first.";
        return;
      }

      const match = findBestMatch(msg);
      if (!match) {
        answerDiv.textContent =
          "I don't know how to answer that yet. Try training me with a similar prompt.";
      } else {
        answerDiv.textContent = match.response;
      }
    });

    // Initial render
    renderExamples();
  </script>
</body>
</html>
